<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Edit Prize</title>
  <link rel="stylesheet" href="/prizes/prizes.css">
</head>
<body>
  <header>
    <img src="/images/exhall-grange-logo.png" alt="Exhall Grange School Logo" class="exhall-logo">
    <h1>Edit Prize</h1>
  </header>

  <main>
    <form id="editPrizeForm" method="POST">
      <div class="form-group">
        <label for="description">Description:</label>
        <input type="text" id="description" name="description" required />
      </div>
      <div class="form-group">
        <label for="cost_merits">Cost (APs):</label>
        <input type="number" id="cost_merits" name="cost_merits" min="0" required />
      </div>
      <div class="form-group">
        <label for="cost_money">Cost (Money):</label>
        <input type="number" id="cost_money" name="cost_money" min="0" required />
      </div>
      <div class="form-group">
        <label for="image_path">Image Path:</label>
        <input type="text" id="image_path" name="image_path" required />
      </div>
      <fieldset class="cycle-toggle">
        <legend>Cycle-based spaces</legend>
        <div class="form-group">
          <label>
            <input type="checkbox" id="is_cycle_limited" name="is_cycle_limited" />
            Use spaces per cycle (ignore total stock)
          </label>
        </div>
        <div class="form-group">
          <label for="spaces_per_cycle">Spaces per cycle:</label>
          <input type="number" id="spaces_per_cycle" name="spaces_per_cycle" min="0" value="0" />
        </div>
        <div class="form-group">
          <label for="cycle_weeks">Cycle length (weeks, 0 = weekly):</label>
          <input type="number" id="cycle_weeks" name="cycle_weeks" min="0" max="52" value="0" />
        </div>
        <div class="form-group">
          <label for="reset_day_iso">Reset day (02:00 Europe/London):</label>
          <select id="reset_day_iso" name="reset_day_iso">
            <option value="1">Monday</option>
            <option value="2">Tuesday</option>
            <option value="3">Wednesday</option>
            <option value="4">Thursday</option>
            <option value="5">Friday</option>
            <option value="6">Saturday</option>
            <option value="7">Sunday</option>
          </select>
        </div>
      </fieldset>
      <div class="form-group">
        <label for="active">Active:</label>
        <select id="active" name="active">
          <option value="true">True</option>
          <option value="false">False</option>
        </select>
      </div>
      <button type="submit">Update Prize</button>
    </form>
  </main>

  <script>
    // Inline JS or reference an editPrize.js file
    document.addEventListener('DOMContentLoaded', async () => {
      const form = document.getElementById('editPrizeForm');
      // Parse the URL to get the prize_id from /prizes/edit/:id
      const pathParts = window.location.pathname.split('/');
      const prizeId = pathParts[pathParts.length - 1];

      // 1) Fetch existing prize data
      try {
        const res = await fetch(`/prizes/${prizeId}/json`);
        if (!res.ok) throw new Error('Failed to load prize');
        const prize = await res.json();

        document.getElementById('description').value = prize.description;
        document.getElementById('cost_merits').value = prize.cost_merits;
        document.getElementById('cost_money').value = prize.cost_money;
        document.getElementById('image_path').value = prize.image_path;
        document.getElementById('active').value = prize.active ? 'true' : 'false';
        document.getElementById('is_cycle_limited').checked = !!prize.is_cycle_limited;
        document.getElementById('spaces_per_cycle').value = prize.spaces_per_cycle ?? 0;
        document.getElementById('cycle_weeks').value = prize.cycle_weeks ?? 0;
        document.getElementById('reset_day_iso').value = prize.reset_day_iso ?? 1;

        // 2) Set form action to /prizes/edit/:id
        form.action = `/prizes/edit/${prizeId}`;
      } catch (err) {
        console.error('Error loading prize:', err);
      }
    });
  </script>
</body>
</html>
